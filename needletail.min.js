import{Client as e}from"@needletail/js";import t from"mustache";import s from"lodash/debounce";class i{constructor(e){this.autocompleteBar=[],this.groupedSearchBar=[],this.result=[],this.aggregationBar=[],this.client=e}add(e){switch(e.discriminator){case"AutocompleteBar":this.autocompleteBar.push(e);break;case"GroupedSearchBar":this.groupedSearchBar.push(e);break;case"Result":this.result.push(e);break;case"AggregationBar":this.aggregationBar.push(e);break;default:throw console.error(e),new Error("Unsupported widget: "+e.discriminator)}e.setClient(this.client).build()}addMultiple(e){e.forEach((e=>{this.add(e)}))}}class l extends e{constructor(e,t=null){super(e,t),this.widgets=new i(this)}addWidget(e){return this.widgets.add(e),this}addMultipleWidgets(e){return this.widgets.addMultiple(e),this}}class a{constructor(e={}){this.template=null,this.values={},this.value={},this.collapsible=!1,this.defaultCollapsed=!1,this.hasActiveAggregation=!0,this.setTitle(e.title||""),this.setClassTitle(this.getTitle()||""),this.setTemplate(e.template||""),this.setAttribute(e.attribute||this.getTitle()),this.setCollapsible(e.collapsible||this.getCollapsible()),this.setDefaultCollapsed(e.default_collapsed||this.getDefaultCollapsed())}setClassTitle(e){return this.classTitle=e.replace(/ /g,"-"),this}getClassTitle(){return this.classTitle}setAttribute(e){return this.attribute=e,this.value.field||(this.value={field:this.attribute,value:"",is_aggregation:!0,exclude_from_search:!0}),this}getAttribute(){return this.attribute}setCollapsible(e){return this.collapsible=e,this}getCollapsible(){return this.collapsible}setDefaultCollapsed(e){return this.defaultCollapsed=e,this}getDefaultCollapsed(){return this.defaultCollapsed}setTitle(e){return this.title=e,this.setClassTitle(this.title),this}getTitle(){return this.title}setTemplate(e){return this.template=e,this}getTemplate(){return this.template}render(){return this.getTemplate()}executeJS(){}reset(){}}class n{constructor(e={}){this.setEl(e.el||"")}setEl(e){return this.el=e,this}getEl(){return this.el}getTemplate(){return this.template}setTemplate(e){return this.template=e,this}setClient(e){return this.client=e,this}render(e={}){const t=this.getTemplate();return document.createRange().createContextualFragment(t)}executeJS(){}build(e={}){const t=document.querySelectorAll(this.getEl()),s=this.render(e);t.forEach((e=>{e.innerHTML="",e.appendChild(s.cloneNode(!0))})),this.executeJS()}}class r{static addToHistory(e,t,s=!1){const i=new URL(window.location.href);if(s&&i.searchParams.has(e)){const s=i.searchParams.getAll(e),l=s.indexOf(String(t));l>-1?(i.searchParams.delete(e),delete s[l],s.forEach((t=>i.searchParams.append(e,t)))):i.searchParams.append(e,t)}else i.searchParams.delete(e),t&&i.searchParams.append(e,t);let l=i.searchParams.toString();l=l?`?${l}`:i.pathname,history.pushState({},document.title,l)}static getSearchParam(e){return new URL(window.location.href).searchParams.get(e)}static getSearchParams(e){return new URL(window.location.href).searchParams.getAll(e)}}class o{constructor(e){if(this.value=e,"object"==typeof this.value&&null!==this.value)return new Proxy(this.value,{get:(e,t,s)=>Reflect.get(e,t,s)})}}function h(e=null,t=null){return null===t?new o(e):null!==e?t(e):void 0}class u{static emit(e,t={}){const s=new CustomEvent(e,{detail:t});document.dispatchEvent(s)}}u.onSubmitGroupedSearch="onSubmitGroupedSearch",u.onGroupedSearch="onGroupedSearch",u.onBeforeGroupedSearch="onBeforeGroupedSearch",u.onAfterGroupedSearch="onAfterGroupedSearch",u.onArrowMovementGroupedSearch="onArrowMovementGroupedSearch",u.onSubmitSearch="onSubmitSearch",u.onSearch="onSearch",u.onBeforeSearch="onBeforeSearch",u.onAfterSearch="onAfterSearch",u.onArrowMovementSearch="onArrowMovementSearch",u.onForceResultBlur="onForceResultBlur",u.onResultRequest="onResultRequest",u.onBeforeResultRequest="onBeforeResultRequest",u.onAfterResultRequest="onAfterResultRequest",u.onPageChange="onPageChange",u.onClickResult="onClickResult",u.onAggsUpdate="onAggsUpdate",u.onAggregationValueChange="onAggregationValueChange",u.autocompleteBarFinished="autocompleteBarFinished",u.groupedSearchBarFinished="groupedSearchBarFinished",u.resultFinished="resultFinished",u.aggregationFinished="aggregationFinished";class d extends a{constructor(e={}){super(e),this.discriminator="Switch",this.onValue="On",this.offValue="Off",this.setOnValue(e.on_value||this.getOnValue()),this.setOffValue(e.off_value||this.getOffValue()),this.setAttributeValue(e.attribute_value||this.getAttributeValue()),this.value={field:this.getAttribute(),value:"",is_aggregation:!0,exclude_from_search:!0}}setAttributeValue(e){return this.attributeValue=e,this}getAttributeValue(){return this.attributeValue.toString()}setOnValue(e){return this.onValue=e,this}getOnValue(){return this.onValue}setOffValue(e){return this.offValue=e,this}getOffValue(){return this.offValue}getTemplate(){return this.template?this.template:'<div class="needletail-aggregation needletail-aggregation-switch needletail-aggregation-switch-{{ class_title }} {{ collapsible }} {{ collapsed }}">\n    <div class="needletail-aggregation-switch-title">\n        {{ title }}\n    </div>\n    <div class="needletail-collapsible-container">\n        <span class="needletail-aggregation-boolean-label">{{ off_value }}</span>\n        <label class="needletail-aggregation-switch-container">\n            <input type="checkbox" name="{{ name }}" value="{{ value }}" class="needletail-aggregation-switch-input needletail-aggregation-switch-input-{{ name }}">\n            <span class="needletail-aggregation-switch-slider"></span>\n        </label>\n        <span class="needletail-aggregation-boolean-label">{{ on_value }}</span>\n    </div>\n</div>'}render(){const e=this.getTemplate();return t.render(e,{title:this.getTitle(),class_title:this.getClassTitle(),name:this.getClassTitle(),on_value:this.getOnValue(),off_value:this.getOffValue(),collapsible:this.getCollapsible()?"needletail-collapsible":"",collapsed:this.getCollapsible()&&this.getDefaultCollapsed()?"needletail-collapsed":""})}executeJS(){const e=this.getTitle(),t=r.getSearchParam(e);document.querySelectorAll(`.needletail-aggregation-switch-input.needletail-aggregation-switch-input-${this.getClassTitle()}`).forEach((t=>{t.checked=r.getSearchParam(e)===this.getAttributeValue(),t.addEventListener("change",(()=>{this.handle(t)})),t.checked&&(this.hasActiveAggregation=!0,u.emit(u.onAggregationValueChange,{name:this.getAttribute(),hasActive:this.hasActiveAggregation}))})),document.querySelectorAll(`.needletail-aggregation.needletail-aggregation-switch.needletail-aggregation-switch-${this.getClassTitle()}`).forEach((e=>{this.getCollapsible()&&e.querySelector(".needletail-aggregation-switch-title").addEventListener("click",(t=>{e.classList.contains("needletail-collapsed")?e.classList.remove("needletail-collapsed"):e.classList.add("needletail-collapsed")}))})),this.values[t]=t,this.value={field:this.getAttribute(),value:t,is_aggregation:!0}}handle(e,t=!1){const s=this.getAttributeValue();t||r.addToHistory(this.getTitle(),s,!0),this.values[s]?delete this.values[s]:this.values[s]=s,this.value={field:this.getAttribute(),value:this.values[s]?s:"",is_aggregation:!0},this.hasActiveAggregation=!0,this.values[s]||(this.value={field:this.getAttribute(),value:"",is_aggregation:!0,exclude_from_search:!0},this.hasActiveAggregation=!1),u.emit(u.onBeforeResultRequest,{}),u.emit(u.onAggregationValueChange,{name:this.getAttribute(),hasActive:this.hasActiveAggregation})}reset(){document.querySelectorAll(`.needletail-aggregation-switch-input.needletail-aggregation-switch-input-${this.getClassTitle()}`).forEach((e=>{e.checked&&(e.checked=!1,this.handle(e))}))}}class c extends a{constructor(e={}){super(e),this.discriminator="Checkbox",this.hideOnEmpty=!0,this.useShowMoreOptions=!0,this.showMoreOptionsText="Show more options",this.showLessOptionsText="Show less options",this.showMoreOptionsLoad=10,this.optionOrder=[],this.neverHideChecked=!0,this.showSelectedZero=!0,this.setHideOnEmpty(e.hide_on_empty||this.getHideOnEmpty()),this.setUseShowMoreOptions(void 0!==h(e.show_more_options).use?e.show_more_options.use:this.getUseShowMoreOptions()),this.setShowMoreOptionsText(h(e.show_more_options).text?e.show_more_options.text:this.getShowMoreOptionsText()),this.setShowLessOptionsText(h(e.show_more_options).less_text?e.show_more_options.less_text:this.getShowLessOptionsText()),this.setShowMoreOptionsLoad(h(e.show_more_options).load?e.show_more_options.load:this.getShowMoreOptionsLoad()),this.setOptionOrder(e.option_order||this.getOptionOrder()),this.setNeverHideChecked(h(e.show_more_options).never_hide_checked?e.show_more_options.never_hide_checked:this.getNeverHideChecked()),this.setShowSelectedZero(void 0!==e.show_selected_zero?e.show_selected_zero:this.getShowSelectedZero()),this.value={field:this.getAttribute(),value:"",is_aggregation:!0,exclude_from_search:!0}}setOptionOrder(e){return this.optionOrder=e.map((e=>e.toLowerCase())),this}getOptionOrder(){return this.optionOrder}setShowSelectedZero(e){return this.showSelectedZero=e,this}getShowSelectedZero(){return this.showSelectedZero}setNeverHideChecked(e){return this.neverHideChecked=e,this}getNeverHideChecked(){return this.neverHideChecked}setUseShowMoreOptions(e){return this.useShowMoreOptions=e,this}getUseShowMoreOptions(){return this.useShowMoreOptions}setShowMoreOptionsText(e){return this.showMoreOptionsText=e,this}getShowMoreOptionsText(){return this.showMoreOptionsText}setShowLessOptionsText(e){return this.showLessOptionsText=e,this}getShowLessOptionsText(){return this.showLessOptionsText}setShowMoreOptionsLoad(e){return this.showMoreOptionsLoad=e,this}getShowMoreOptionsLoad(){return this.showMoreOptionsLoad}getTemplate(){return this.template?this.template:'<div class="needletail-aggregation needletail-aggregation-checkbox needletail-aggregation-checkbox-{{ class_title }} {{ collapsible }} {{ collapsed }}">\n    <div class="needletail-aggregation-checkbox-title">\n        {{ title }}\n    </div>\n    <div class="needletail-collapsible-container">\n        {{#options}}\n            <label class="needletail-aggregation-checkbox-option {{#show_more_options}}needletail-hidden{{/show_more_options}}">\n                <input type="checkbox" name="{{ name }}" value="{{ value }}" class="needletail-aggregation-checkbox-option-input needletail-aggregation-checkbox-option-input-{{ name }}">\n                <span class="needletail-aggregation-checkbox-option-checkmark"></span>\n                <span class="needletail-aggregation-checkbox-option-label">{{ value }}</span>\n                <span class="needletail-aggregation-checkbox-option-count">{{ count }}</span>\n            </label>\n        {{/options}}\n        {{#show_more_options}}\n            <div class="needletail-show-more-options">{{{ show_more_options_text }}}</div>\n            <div class="needletail-show-less-options needletail-hidden">{{{ show_less_options_text }}}</div>\n        {{/show_more_options}}\n    </div>\n</div>\n'}setHideOnEmpty(e){return this.hideOnEmpty=e,this}getHideOnEmpty(){return this.hideOnEmpty}render(e=[]){const s=this.getTemplate();return this.getOptionOrder()&&e.sort(((e,t)=>{let s=this.getOptionOrder().indexOf(e.value.toLowerCase()),i=this.getOptionOrder().indexOf(t.value.toLowerCase());return-1===s&&(s=9999),-1===i&&(i=9999),s-i})),t.render(s,{title:this.getTitle(),class_title:this.getClassTitle(),options:e,collapsible:this.getCollapsible()?"needletail-collapsible":"",collapsed:this.getCollapsible()&&this.getDefaultCollapsed()?"needletail-collapsed":"",show_more_options:this.getUseShowMoreOptions(),show_more_options_text:this.getShowMoreOptionsText(),show_less_options_text:this.getShowLessOptionsText()})}executeJS(){const e=this.getTitle();document.addEventListener(u.onAggsUpdate,(t=>{if(t.detail[this.getAttribute()]){const s=[];t.detail[this.getAttribute()].forEach((e=>{s.push(Object.assign({name:this.getClassTitle()},e))}));const i=this.render(s),l=document.createRange().createContextualFragment(i);let a=!1,n=!1;document.querySelectorAll(`.needletail-aggregation.needletail-aggregation-checkbox.needletail-aggregation-checkbox-${this.getClassTitle()}`).forEach((e=>{a=e.classList.contains("needletail-collapsed");const t=e.querySelector(".needletail-show-more-options"),s=e.querySelector(".needletail-show-less-options");if(this.getUseShowMoreOptions()){n=!t.classList.contains("needletail-hidden");t.classList.contains("needletail-hidden")&&s.classList.contains("needletail-hidden")&&(n=!0)}e.replaceWith(l.cloneNode(!0))})),document.querySelectorAll(`.needletail-aggregation.needletail-aggregation-checkbox.needletail-aggregation-checkbox-${this.getClassTitle()}`).forEach((e=>{if(this.getCollapsible()&&(e.querySelector(".needletail-aggregation-checkbox-title").addEventListener("click",(t=>{e.classList.contains("needletail-collapsed")?e.classList.remove("needletail-collapsed"):e.classList.add("needletail-collapsed")})),a&&e.classList.add("needletail-collapsed")),e.setAttribute("data-option-count",s.length.toString()),this.getHideOnEmpty()&&(0===s.length?e.classList.add("needletail-empty"):e.classList.remove("needletail-empty")),this.getUseShowMoreOptions()){const t=e.querySelector(".needletail-show-more-options"),s=e.querySelector(".needletail-show-less-options"),i=e.querySelectorAll(".needletail-aggregation-checkbox-option");i.length<=this.getShowMoreOptionsLoad()&&t.classList.add("needletail-hidden");const l=this.getShowMoreOptionsLoad()>i.length?i.length:this.getShowMoreOptionsLoad();for(let e=0;e<l;e++)i.item(e).classList.remove("needletail-hidden");t.addEventListener("click",(e=>{t.classList.add("needletail-hidden"),s.classList.remove("needletail-hidden");for(let e=this.getShowMoreOptionsLoad();e<i.length;e++)i.item(e).classList.remove("needletail-hidden")})),s.addEventListener("click",(e=>{s.classList.add("needletail-hidden"),t.classList.remove("needletail-hidden");for(let e=this.getShowMoreOptionsLoad();e<i.length;e++){const t=i.item(e);t.querySelector(".needletail-aggregation-checkbox-option-input").checked&&this.getNeverHideChecked()||t.classList.add("needletail-hidden")}})),!n&&i.length>this.getShowMoreOptionsLoad()&&t.click()}})),document.querySelectorAll(`.needletail-aggregation-checkbox-option-input.needletail-aggregation-checkbox-option-input-${this.getClassTitle()}`).forEach((e=>{e.addEventListener("change",(()=>{this.handle(e)}))}));const o=r.getSearchParams(e);o&&o.forEach((e=>{const t=document.querySelectorAll(`.needletail-aggregation-checkbox-option-input-${this.getClassTitle()}[value='${e}']`);if(0===t.length){if(this.getShowSelectedZero()){const t=e.replace(/(<([^>]+)>)/gi,"");if(t){const e=document.querySelectorAll(`.needletail-aggregation-checkbox-${this.getClassTitle()} .needletail-aggregation-checkbox-option`),s=e[e.length-1],i=s.cloneNode(!0);s.after(i);const l=document.querySelectorAll(`.needletail-aggregation-checkbox-${this.getClassTitle()} .needletail-aggregation-checkbox-option`),a=l[l.length-1],n=a.querySelector(".needletail-aggregation-checkbox-option-label"),r=a.querySelector(".needletail-aggregation-checkbox-option-count"),o=a.querySelector(".needletail-aggregation-checkbox-option-input");n&&(n.innerHTML=t),r&&(r.innerHTML="0"),o&&(o.setAttribute("value",t),o.checked=!0,this.values[t]=t,o.addEventListener("change",(()=>{this.handle(o)})))}}}else t.forEach((e=>{e.checked=!0,e.parentElement.classList.remove("needletail-hidden")}))}))}else this.getHideOnEmpty()&&document.querySelectorAll(`.needletail-aggregation.needletail-aggregation-checkbox.needletail-aggregation-checkbox-${this.getClassTitle()}`).forEach((e=>{e.classList.add("needletail-empty")}))}));const t=r.getSearchParams(e);t&&(t.forEach((e=>{e&&(this.values[e]=e)})),this.value={field:this.getAttribute(),value:Object.keys(this.values),is_aggregation:!0},this.hasActiveAggregation=!0,0===Object.keys(this.values).length&&(this.hasActiveAggregation=!1,this.value={field:this.getAttribute(),value:"",is_aggregation:!0,exclude_from_search:!0}),u.emit(u.onAggregationValueChange,{name:this.getAttribute(),hasActive:this.hasActiveAggregation}))}handle(e,t=!1){t||r.addToHistory(this.getTitle(),e.value,!0),this.values[e.value]?delete this.values[e.value]:this.values[e.value]=e.value,this.value={field:this.getAttribute(),value:Object.keys(this.values),is_aggregation:!0},this.hasActiveAggregation=!0,0===Object.keys(this.values).length&&(this.value={field:this.getAttribute(),value:"",is_aggregation:!0,exclude_from_search:!0},this.hasActiveAggregation=!1),u.emit(u.onBeforeResultRequest,{}),u.emit(u.onAggregationValueChange,{name:this.getAttribute(),hasActive:this.hasActiveAggregation})}reset(){document.querySelectorAll(`.needletail-aggregation-checkbox-option-input.needletail-aggregation-checkbox-option-input-${this.getClassTitle()}`).forEach((e=>{e.checked&&(e.checked=!1,this.handle(e))}))}}class g extends a{constructor(e={}){super(e),this.discriminator="Radio",this.hideOnEmpty=!0,this.useShowMoreOptions=!0,this.showMoreOptionsText="Show more options",this.showLessOptionsText="Show less options",this.showMoreOptionsLoad=10,this.optionOrder=[],this.setHideOnEmpty(e.hide_on_empty||this.getHideOnEmpty()),this.setUseShowMoreOptions(void 0!==h(e.show_more_options).use?e.show_more_options.use:this.getUseShowMoreOptions()),this.setShowMoreOptionsText(h(e.show_more_options).text?e.show_more_options.text:this.getShowMoreOptionsText()),this.setShowLessOptionsText(h(e.show_more_options).less_text?e.show_more_options.less_text:this.getShowLessOptionsText()),this.setShowMoreOptionsLoad(h(e.show_more_options).load?e.show_more_options.load:this.getShowMoreOptionsLoad()),this.setOptionOrder(e.option_order||this.getOptionOrder()),this.value={field:this.getAttribute(),value:"",is_aggregation:!0,exclude_from_search:!0}}setOptionOrder(e){return this.optionOrder=e.map((e=>e.toLowerCase())),this}getOptionOrder(){return this.optionOrder}setUseShowMoreOptions(e){return this.useShowMoreOptions=e,this}getUseShowMoreOptions(){return this.useShowMoreOptions}setShowMoreOptionsText(e){return this.showMoreOptionsText=e,this}getShowMoreOptionsText(){return this.showMoreOptionsText}setShowLessOptionsText(e){return this.showLessOptionsText=e,this}getShowLessOptionsText(){return this.showLessOptionsText}setShowMoreOptionsLoad(e){return this.showMoreOptionsLoad=e,this}getShowMoreOptionsLoad(){return this.showMoreOptionsLoad}getTemplate(){return this.template?this.template:'<div class="needletail-aggregation needletail-aggregation-radio needletail-aggregation-radio-{{ class_title }} {{ collapsible }} {{ collapsed }}">\n    <div class="needletail-aggregation-radio-title">\n        {{ title }}\n    </div>\n    <div class="needletail-collapsible-container">\n        {{#options}}\n            <label class="needletail-aggregation-radio-option {{#show_more_options}}needletail-hidden{{/show_more_options}}">\n                <input type="radio" name="{{ name }}" value="{{ value }}" class="needletail-aggregation-radio-option-input needletail-aggregation-radio-option-input-{{ name }}">\n                <span class="needletail-aggregation-radio-option-checkmark"></span>\n                <span class="needletail-aggregation-radio-option-label">{{ value }}</span>\n                <span class="needletail-aggregation-radio-option-count">{{ count }}</span>\n            </label>\n        {{/options}}\n        {{#show_more_options}}\n            <div class="needletail-show-more-options">{{{ show_more_options_text }}}</div>\n            <div class="needletail-show-less-options needletail-hidden">{{{ show_less_options_text }}}</div>\n        {{/show_more_options}}\n    </div>\n</div>\n'}setHideOnEmpty(e){return this.hideOnEmpty=e,this}getHideOnEmpty(){return this.hideOnEmpty}render(e=[]){const s=this.getTemplate();return this.getOptionOrder()&&e.sort(((e,t)=>{let s=this.getOptionOrder().indexOf(e.value.toLowerCase()),i=this.getOptionOrder().indexOf(t.value.toLowerCase());return-1===s&&(s=9999),-1===i&&(i=9999),s-i})),t.render(s,{title:this.getTitle(),class_title:this.getClassTitle(),options:e,collapsible:this.getCollapsible()?"needletail-collapsible":"",collapsed:this.getCollapsible()&&this.getDefaultCollapsed()?"needletail-collapsed":"",show_more_options:this.getUseShowMoreOptions(),show_more_options_text:this.getShowMoreOptionsText(),show_less_options_text:this.getShowLessOptionsText()})}executeJS(){const e=this.getTitle(),t=r.getSearchParam(e);document.addEventListener(u.onAggsUpdate,(t=>{if(t.detail[this.getAttribute()]){const s=[];t.detail[this.getAttribute()].forEach((e=>{s.push(Object.assign({name:this.getClassTitle()},e))}));const i=this.render(s),l=document.createRange().createContextualFragment(i);let a=!1,n=!1;document.querySelectorAll(`.needletail-aggregation.needletail-aggregation-radio.needletail-aggregation-radio-${this.getClassTitle()}`).forEach((e=>{a=e.classList.contains("needletail-collapsed");const t=e.querySelector(".needletail-show-more-options"),s=e.querySelector(".needletail-show-less-options");if(this.getUseShowMoreOptions()){n=!t.classList.contains("needletail-hidden");t.classList.contains("needletail-hidden")&&s.classList.contains("needletail-hidden")&&(n=!0)}e.replaceWith(l.cloneNode(!0))})),document.querySelectorAll(`.needletail-aggregation.needletail-aggregation-radio.needletail-aggregation-radio-${this.getClassTitle()}`).forEach((e=>{if(this.getCollapsible()&&(e.querySelector(".needletail-aggregation-radio-title").addEventListener("click",(t=>{e.classList.contains("needletail-collapsed")?e.classList.remove("needletail-collapsed"):e.classList.add("needletail-collapsed")})),a&&e.classList.add("needletail-collapsed")),e.setAttribute("data-option-count",s.length.toString()),this.getHideOnEmpty()&&(0===s.length?e.classList.add("needletail-empty"):e.classList.remove("needletail-empty")),this.getUseShowMoreOptions()){const t=e.querySelector(".needletail-show-more-options"),s=e.querySelector(".needletail-show-less-options"),i=e.querySelectorAll(".needletail-aggregation-radio-option");i.length<=this.getShowMoreOptionsLoad()&&t.classList.add("needletail-hidden");const l=this.getShowMoreOptionsLoad()>i.length?i.length:this.getShowMoreOptionsLoad();for(let e=0;e<l;e++)i.item(e).classList.remove("needletail-hidden");t.addEventListener("click",(e=>{t.classList.add("needletail-hidden"),s.classList.remove("needletail-hidden");for(let e=this.getShowMoreOptionsLoad();e<i.length;e++)i.item(e).classList.remove("needletail-hidden")})),s.addEventListener("click",(e=>{s.classList.add("needletail-hidden"),t.classList.remove("needletail-hidden");for(let e=this.getShowMoreOptionsLoad();e<i.length;e++)i.item(e).classList.add("needletail-hidden")})),!n&&i.length>this.getShowMoreOptionsLoad()&&t.click()}})),document.querySelectorAll(`.needletail-aggregation-radio-option-input.needletail-aggregation-radio-option-input-${this.getClassTitle()}`).forEach((e=>{e.addEventListener("change",(()=>{this.handle(e)}))})),document.querySelectorAll(`.needletail-aggregation-radio-option-input.needletail-aggregation-radio-option-input-${this.getClassTitle()}`).forEach((t=>{t.checked=r.getSearchParam(e)===t.value,t.addEventListener("change",(()=>{this.handle(t)}))}))}})),this.value={field:this.getAttribute(),value:t,is_aggregation:!0}}handle(e,t=!1,s=!1){t||r.addToHistory(this.getTitle(),e.value,s),s&&(e.value=""),this.value={field:this.getAttribute(),value:e.value,is_aggregation:!0},this.hasActiveAggregation=!0,e.value||(this.value={field:this.getAttribute(),value:"",is_aggregation:!0,exclude_from_search:!0},this.hasActiveAggregation=!1),u.emit(u.onBeforeResultRequest,{}),u.emit(u.onAggregationValueChange,{name:this.getAttribute(),hasActive:this.hasActiveAggregation})}reset(){document.querySelectorAll(`.needletail-aggregation-radio-option-input.needletail-aggregation-radio-option-input-${this.getClassTitle()}`).forEach((e=>{e.checked&&(e.checked=!1,this.handle(e,!1,!0))}))}}class p extends a{constructor(e={}){super(e),this.discriminator="Range",this.range=!1,this.type="to",this.allowedTypes=["to","from","from:to"],this.inputs="top",this.allowedInputs=["top","bottom"],this.displayOnly=!1,this.setRange(e.min||0,e.max||10),this.setDefaultValue("number"==typeof e.default_value?e.default_value:5),this.setRangeSlider(void 0!==e.range?e.range:this.getRangeSlider()),this.setDefaultRangeMin(e.default_range_min||this.getMin()),this.setDefaultRangeMax(e.default_range_max||this.getMax()),this.setType(e.type||this.getType()),this.setInputs(e.inputs||this.getInputs()),this.setDisplayOnly(void 0!==e.display_only?e.display_only:this.getDisplayOnly());let t=this.getDefaultValue().toString();this.getRangeSlider()&&(this.setType("from:to"),t=this.getDefaultRangeMin()+":"+this.getDefaultRangeMax()),this.value={field:this.getAttribute(),value:t,type:this.getType(),is_aggregation:!0,exclude_from_search:!0},this.ranges={},this.elements={}}setDisplayOnly(e){return this.displayOnly=e,this}getDisplayOnly(){return this.displayOnly}setType(e){return-1===this.allowedTypes.indexOf(e)?e="to":"from:to"!==e||this.getRangeSlider()||(e="to"),this.type=e,this}getType(){return this.type}setInputs(e){return-1===this.allowedInputs.indexOf(e)&&(e="top"),this.inputs=e,this}getInputs(){return this.inputs}setRangeSlider(e){return this.range=e,this}getRangeSlider(){return this.range}setMin(e){return this.min=e,this}getMin(){return this.min}setMax(e){return this.max=e,this}getMax(){return this.max}setDefaultValue(e){return this.defaultValue=e,this}getDefaultValue(){return this.defaultValue}setDefaultRangeMin(e){return this.defaultRangeMin=e,this}getDefaultRangeMin(){return this.defaultRangeMin}setDefaultRangeMax(e){return this.defaultRangeMax=e,this}getDefaultRangeMax(){return this.defaultRangeMax}setRange(e,t){return this.setMin(e),this.setMax(t),this}getTemplate(){return this.template?this.template:this.getRangeSlider()?'<div class="needletail-aggregation needletail-aggregation-slider needletail-aggregation-slider-{{ class_title }} {{ collapsible }} {{ collapsed }}">\n    <div class="needletail-aggregation-slider-title">\n        {{ title }}\n    </div>\n    <div class="needletail-collapsible-container">\n        <div class="needletail-aggregation-slider-container__range">\n            {{#inputs_top}}\n            <div class="needletail-aggregation-slider-inputs top">\n                <input type="number" class="needletail-aggregation-slider-input-min {{ display_only }}">\n                <input type="number" class="needletail-aggregation-slider-input-max {{ display_only }}">\n            </div>\n            {{/inputs_top}}\n            <div class="needletail-aggregation-slider-range-container">\n                <div class="needletail-aggregation-slider-range">\n                    <div class="needletail-aggregation-slider-range-left"></div>\n                    <div class="needletail-aggregation-slider-range-divider"></div>\n                    <div class="needletail-aggregation-slider-range-right"></div>\n                </div>\n            </div>\n            {{#inputs_bottom}}\n                <div class="needletail-aggregation-slider-inputs bottom">\n                    <input type="number" class="needletail-aggregation-slider-input-min {{ display_only }}">\n                    <input type="number" class="needletail-aggregation-slider-input-max {{ display_only }}">\n                </div>\n            {{/inputs_bottom}}\n        </div>\n    </div>\n</div>':'<div class="needletail-aggregation needletail-aggregation-slider needletail-aggregation-slider-{{ class_title }} {{ collapsible }} {{ collapsed }}">\n    <div class="needletail-aggregation-slider-title">\n        {{ title }}\n    </div>\n    <div class="needletail-collapsible-container">\n        <div class="needletail-aggregation-slider-container">\n            <input type="range" name="{{ name }}" min="{{ min }}" max="{{ max }}" value="{{ value }}" class="needletail-aggregation-slider-input needletail-aggregation-slider-input-{{ name }}">\n        </div>\n    </div>\n</div>'}render(){const e=this.getTemplate();return t.render(e,{title:this.getTitle(),class_title:this.getClassTitle(),name:this.getClassTitle(),min:this.getMin(),max:this.getMax(),value:this.getDefaultValue(),collapsible:this.getCollapsible()?"needletail-collapsible":"",collapsed:this.getCollapsible()&&this.getDefaultCollapsed()?"needletail-collapsed":"",inputs_bottom:"bottom"===this.getInputs(),inputs_top:"top"===this.getInputs(),display_only:this.getDisplayOnly()?"display-only":""})}executeJS(){const e=this.getTitle(),t=r.getSearchParam(e);document.querySelectorAll(`.needletail-aggregation-slider-input.needletail-aggregation-slider-input-${this.getClassTitle()}`).forEach((e=>{e.value=t||this.getDefaultValue().toString(),document.addEventListener("DOMContentLoaded",(()=>{this.handle(e,!0)})),e.addEventListener("change",(()=>{this.handle(e)}))})),document.querySelectorAll(".needletail-aggregation-slider-container__range").forEach((t=>{document.addEventListener("DOMContentLoaded",(()=>{this.elements[this.getClassTitle()]={slider:t.querySelector(".needletail-aggregation-slider-range"),inputMin:t.querySelector(".needletail-aggregation-slider-input-min"),inputMax:t.querySelector(".needletail-aggregation-slider-input-max"),leftSlider:t.querySelector(".needletail-aggregation-slider-range-left"),rightSlider:t.querySelector(".needletail-aggregation-slider-range-right"),divider:t.querySelector(".needletail-aggregation-slider-range-divider")};const i=this.elements[this.getClassTitle()].slider,l=this.elements[this.getClassTitle()].inputMin,a=this.elements[this.getClassTitle()].inputMax,n=this.elements[this.getClassTitle()].leftSlider,o=this.elements[this.getClassTitle()].rightSlider,h=this.elements[this.getClassTitle()].divider;l.value=r.getSearchParam(e+"[min]")||this.getDefaultRangeMin().toString(),a.value=r.getSearchParam(e+"[max]")||this.getDefaultRangeMax().toString(),[l,a].forEach((e=>{e.min=this.getMin().toString(),e.max=this.getMax().toString()})),this.ranges[this.getClassTitle()]=this.calculatePositions(i,n,o),window.onresize=e=>{this.ranges[this.getClassTitle()]=this.calculatePositions(i,n,o),this.calculateDivider(h,n,o)},l.addEventListener("change",s((()=>{parseInt(l.value)<this.getMin()?l.value=this.getMin().toString():parseInt(l.value)>parseInt(a.value)&&(l.value=a.value);const e=100/this.getMax()*parseInt(l.value);n.style.left=e+"%",a.min=l.value,this.calculateDivider(h,n,o),this.handleRange(l,a)}),200)),a.addEventListener("change",s((()=>{parseInt(a.value)>this.getMax()?a.value=this.getMax().toString():parseInt(a.value)<parseInt(l.value)&&(a.value=l.value);const e=100/this.getMax()*parseInt(a.value);o.style.left=`${e}%`,l.max=a.value,this.calculateDivider(h,n,o),this.handleRange(l,a)}),200)),n.addEventListener("mousedown",(e=>{document.onmousemove=e=>{e.preventDefault(),this.moveLeft(e)},document.onmouseup=e=>{document.onmouseup=null,document.onmousemove=null}})),n.addEventListener("touchstart",(e=>{document.ontouchmove=e=>{e.preventDefault(),this.moveLeft(e)},document.ontouchend=e=>{document.ontouchend=null,document.ontouchmove=null}})),o.addEventListener("mousedown",(e=>{document.onmousemove=e=>{e.preventDefault(),this.moveRight(e)},document.onmouseup=e=>{document.onmouseup=null,document.onmousemove=null}})),o.addEventListener("touchstart",(e=>{document.ontouchmove=e=>{e.preventDefault(),this.moveRight(e)},document.ontouchend=e=>{document.ontouchend=null,document.ontouchmove=null}})),r.getSearchParam(e+"[min]")&&(n.style.left=100/this.getMax()*parseInt(l.value)+"%"),r.getSearchParam(e+"[max]")&&(o.style.left=100/this.getMax()*parseInt(a.value)+"%"),this.calculateDivider(h,n,o)}))})),document.querySelectorAll(`.needletail-aggregation.needletail-aggregation-slider.needletail-aggregation-slider-${this.getClassTitle()}`).forEach((e=>{this.getCollapsible()&&e.querySelector(".needletail-aggregation-slider-title").addEventListener("click",(t=>{e.classList.contains("needletail-collapsed")?e.classList.remove("needletail-collapsed"):e.classList.add("needletail-collapsed")}))}))}handle(e,t=!1){t||r.addToHistory(this.getTitle(),e.value),this.value={field:this.getAttribute(),value:e.value,type:this.getType(),is_aggregation:!0},this.hasActiveAggregation=!0,e.value||(this.value={field:this.getAttribute(),value:this.getDefaultValue(),type:this.getType(),is_aggregation:!0,exclude_from_search:!0},this.hasActiveAggregation=!1),u.emit(u.onBeforeResultRequest,{}),u.emit(u.onAggregationValueChange,{name:this.getAttribute(),hasActive:this.hasActiveAggregation})}handleRange(e,t,s=!1){s||(r.addToHistory(this.getTitle()+"[min]",e.value),r.addToHistory(this.getTitle()+"[max]",t.value)),this.value={field:this.getAttribute(),value:e.value+":"+t.value,type:this.getType(),is_aggregation:!0},this.hasActiveAggregation=!0,e.value||t.value||(this.value={field:this.getAttribute(),value:this.getMin()+":"+this.getMax(),type:this.getType(),is_aggregation:!0,exclude_from_search:!0},this.hasActiveAggregation=!1),u.emit(u.onBeforeResultRequest,{}),u.emit(u.onAggregationValueChange,{name:this.getAttribute(),hasActive:this.hasActiveAggregation})}reset(){document.querySelectorAll(`.needletail-aggregation-slider-input.needletail-aggregation-slider-input-${this.getClassTitle()}`).forEach((e=>{e.value=this.getDefaultValue().toString(),this.handle(e),r.addToHistory(this.getTitle(),e.value,!0),u.emit(u.onAggregationValueChange,{name:this.getAttribute(),hasActive:!1})})),document.querySelectorAll(".needletail-aggregation-slider-container__range").forEach((e=>{const t=this.elements[this.getClassTitle()].inputMin,s=this.elements[this.getClassTitle()].inputMax,i=this.elements[this.getClassTitle()].leftSlider,l=this.elements[this.getClassTitle()].rightSlider,a=this.elements[this.getClassTitle()].divider;t.value=this.getDefaultRangeMin().toString(),s.value=this.getDefaultRangeMax().toString(),i.style.left=100/this.getMax()*parseInt(t.value)+"%",l.style.left=100/this.getMax()*parseInt(s.value)+"%",this.handleRange(t,s),this.calculateDivider(a,i,l),r.addToHistory(this.getTitle()+"[min]",t.value,!0),r.addToHistory(this.getTitle()+"[max]",s.value,!0),u.emit(u.onAggregationValueChange,{name:this.getAttribute(),hasActive:!1}),this.ranges[this.getClassTitle()].leftPosition=this.ranges[this.getClassTitle()].startLeft,this.ranges[this.getClassTitle()].rightPosition=this.ranges[this.getClassTitle()].startRight}))}calculatePositions(e,t,s){const i=e.getBoundingClientRect().x,l=e.getBoundingClientRect().x+e.offsetWidth;return{startLeft:i,startRight:l,leftPosition:t.getBoundingClientRect().x,rightPosition:s.getBoundingClientRect().x,total:l-i}}calculateDivider(e,t,s){const i=s.offsetLeft-t.offsetLeft;e.style.width=i+"px",e.style.left=`${t.style.left}`}moveRight(e){var t;const s=null!==(t=e.clientX)&&void 0!==t?t:e.touches[0].clientX,i=this.elements[this.getClassTitle()].inputMax,l=this.elements[this.getClassTitle()].leftSlider,a=this.elements[this.getClassTitle()].rightSlider,n=this.elements[this.getClassTitle()].divider;if(!this.ranges[this.getClassTitle()])return;let r=s-a.offsetWidth;r<this.ranges[this.getClassTitle()].leftPosition?r=this.ranges[this.getClassTitle()].leftPosition:r>this.ranges[this.getClassTitle()].startRight&&(r=this.ranges[this.getClassTitle()].startRight),this.ranges[this.getClassTitle()].rightPosition=r;const o=100/this.ranges[this.getClassTitle()].total*(r-this.ranges[this.getClassTitle()].startLeft);a.style.left=`${o}%`,i.value=Math.round(this.getMax()/100*o+this.getMin()).toString(),i.dispatchEvent(new Event("change")),this.calculateDivider(n,l,a)}moveLeft(e){var t;const s=null!==(t=e.clientX)&&void 0!==t?t:e.touches[0].clientX,i=this.elements[this.getClassTitle()].inputMin,l=this.elements[this.getClassTitle()].leftSlider,a=this.elements[this.getClassTitle()].rightSlider,n=this.elements[this.getClassTitle()].divider;if(!this.ranges[this.getClassTitle()])return;let r=s-l.offsetWidth/2;r>this.ranges[this.getClassTitle()].rightPosition?r=this.ranges[this.getClassTitle()].rightPosition:r<this.ranges[this.getClassTitle()].startLeft&&(r=this.ranges[this.getClassTitle()].startLeft),this.ranges[this.getClassTitle()].leftPosition=r;const o=100/this.ranges[this.getClassTitle()].total*(r-this.ranges[this.getClassTitle()].startLeft);l.style.left=o+"%",i.value=Math.round(this.getMax()/100*o+this.getMin()).toString(),i.dispatchEvent(new Event("change")),this.calculateDivider(n,l,a)}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function m(e,t,s,i){return new(s||(s=Promise))((function(l,a){function n(e){try{o(i.next(e))}catch(e){a(e)}}function r(e){try{o(i.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?l(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}o((i=i.apply(e,t||[])).next())}))}class v extends n{constructor(e={}){super(e),this.discriminator="AutocompleteBar",this.debounce=!0,this.debounceWait=200,this.debounceUrlWait=2e3,this.query="autocompleteBar",this.inUrl=!0,this.placeholder="Start typing to search",this.noResultMessage="No results where found",this.selectedResult=-1,this.value={},this.size=10,this.minimumCharacters=3,this.groupBy="",this.sortBy="",this.sortDirection="asc",this.showResults=!0,this.useInResults=!0,this.searchOnContentLoaded=!0,this.liveResults=!1,this.initialInput=!0,this.forceUseOfResult=!1,this.skipForceResults=0,this.fillInputOnClick=!1,this.showBucket=!1,this.sortMode="min",this.allowedDirections=["asc","desc"],this.setUseDebounce(void 0!==h(e.debounce).use?e.debounce.use:this.getUseDebounce()),this.setDebounceWait(h(e.debounce).wait||this.getDebounceWait()),this.setDebounceUrlWait(h(e.debounce).url_wait||this.getDebounceUrlWait()),this.setInUrl(void 0!==e.in_url?e.in_url:this.getInUrl()),this.setQuery(e.query||this.getQuery()),this.setAttribute(h(e.search).attribute||""),this.setAttributes(h(e.search).attributes||""),this.setBuckets(h(e.search).buckets||[]),this.setPlaceholder(e.placeholder||this.getPlaceholder()),this.setNoResultMessage(e.no_result_message||this.getNoResultMessage()),this.setSize(h(e.search).size||this.getSize()),this.setGroupBy(h(e.search).group_by||""),this.setSortBy(h(e.search).sort_by||""),this.setSortDirection(h(e.search).sort_direction||this.getSortDirection()),this.setSortMode(h(e.search).sort_mode||this.getSortMode()),this.setMinimumCharacters(void 0!==e.minimum_characters?e.minimum_characters:this.getMinimumCharacters()),this.setShowResults(void 0!==e.show_results?e.show_results:this.getShowResults()),this.setForceUseOfResult(void 0!==e.force_use_of_result?e.force_use_of_result:this.getForceUseOfResult()),this.setUseInResults(void 0!==e.use_in_results?e.use_in_results:this.getUseInResults()),this.setSearchOnContentLoaded(void 0!==e.search_on_content_loaded?e.search_on_content_loaded:this.getSearchOnContentLoaded()),this.setLiveResults(void 0!==e.live_results?e.live_results:this.getLiveResults()),this.setInitialInput(void 0!==e.initial_input?e.initial_input:this.getInitialInput()),this.setFillInputOnClick(void 0!==e.fill_input_on_click?e.fill_input_on_click:this.getFillInputOnClick()),this.setShowBucket(void 0!==h(e.search).show_bucket?e.search.show_bucket:this.getShowBucket()),this.setBucketMapping(h(e.search).bucket_mapping||this.getBucketMapping()),this.getInitialInput()&&(this.skipForceResults=1)}setMinimumCharacters(e){return this.minimumCharacters=e,this}getMinimumCharacters(){return this.minimumCharacters}setSize(e){return this.size=e,this}getSize(){return this.size}setPlaceholder(e){return this.placeholder=e,this}getPlaceholder(){return this.placeholder}setNoResultMessage(e){return this.noResultMessage=e,this}getNoResultMessage(){return this.noResultMessage}setAttribute(e){return this.attribute=e,this}getAttribute(){return this.attribute}setAttributes(e){return""===this.attribute&&(this.attribute=e),this}getAttributes(){return this.attribute}setBuckets(e){return this.buckets=e,this}getBuckets(){return this.buckets}setUseDebounce(e=!0){return this.debounce=e,this}getUseDebounce(){return this.debounce}setDebounceWait(e){return this.debounceWait=e,this}getDebounceWait(){return this.debounceWait}setDebounceUrlWait(e){return this.debounceUrlWait=e,this}getDebounceUrlWait(){return this.debounceUrlWait}getTemplate(){return this.template?this.template:'<div class="needletail-autocomplete-bar needletail-autocomplete-bar-{{ name }}">\n    <input type="text" class="needletail-autocomplete-bar-input needletail-empty" autocomplete="off" spellcheck="false" placeholder="{{ placeholder }}">\n    {{{ results }}}\n</div>'}setResultTemplate(e){return this.resultTemplate=e,this}getResultTemplate(){return this.resultTemplate?this.resultTemplate:'<div class="needletail-autocomplete-bar-results">\n    {{#initial_input}}\n        <div class="needletail-autocomplete-bar-result needletail-initial-input" data-attribute="{{ initial_input }}">\n            {{ initial_input }}\n        </div>\n    {{/initial_input}}\n\n    {{#results}}\n        <div class="needletail-autocomplete-bar-result" data-attribute="{{ raw.title }}">\n            {{#highlight.title}}{{{ highlight.title }}}{{/highlight.title}}{{^highlight.title}}{{ title }}{{/highlight.title}}\n        </div>\n    {{/results}}\n    {{^results}}\n        <div class="needletail-autocomplete-bar-no-result">\n            {{{ no_result_message }}}\n        </div>\n    {{/results}}\n</div>'}setInUrl(e){return this.inUrl=e,this}getInUrl(){return this.inUrl}setShowResults(e){return this.showResults=e,this}getShowResults(){return this.showResults}setDiscriminator(e){return this.discriminator=e,this}getDiscriminator(){return this.discriminator}setSearchOnContentLoaded(e){return this.searchOnContentLoaded=e,this}getSearchOnContentLoaded(){return this.searchOnContentLoaded}setLiveResults(e){return this.liveResults=e,this}getLiveResults(){return this.liveResults}setInitialInput(e){return this.initialInput=e,this}getInitialInput(){return this.initialInput}setFillInputOnClick(e){return this.fillInputOnClick=e,this}getFillInputOnClick(){return this.fillInputOnClick}setForceUseOfResult(e){return this.forceUseOfResult=e,this}getForceUseOfResult(){return this.forceUseOfResult}setUseInResults(e){return this.useInResults=e,this}getUseInResults(){return this.useInResults}setGroupBy(e){return this.groupBy=e,this}getGroupBy(){return this.groupBy}setSortBy(e){return this.sortBy=e,this}getSortBy(){return this.sortBy}setSortMode(e){return this.sortMode=e,this}getSortMode(){return this.sortMode}setSortDirection(e){return-1===this.allowedDirections.indexOf(e)&&(e="asc"),this.sortDirection=e,this}getSortDirection(){return this.sortDirection}setShowBucket(e){return this.showBucket=e,this}getShowBucket(){return this.showBucket}setBucketMapping(e){return this.bucketMapping=e,this}getBucketMapping(){return this.bucketMapping}render(e={}){const s=this.getTemplate();e=Object.assign({name:this.getQuery(),placeholder:this.getPlaceholder(),results:this.renderResults()},e);const i=t.render(s,e);return document.createRange().createContextualFragment(i)}renderResults(e={}){const s=this.getResultTemplate();return e=Object.assign({no_result_message:this.getNoResultMessage()},e),t.render(s,e)}getQuery(){return this.query}setQuery(e){return this.query=e,this}executeJS(){const e=r.getSearchParam(this.getQuery());document.querySelectorAll(`${this.getEl()} .needletail-autocomplete-bar-input`).forEach((t=>{this.getForceUseOfResult()&&t.setAttribute("data-force","on"),t.value=e||"",document.addEventListener("DOMContentLoaded",(()=>{this.getSearchOnContentLoaded()&&this.handle(t)})),t.addEventListener("focus",(()=>{t.classList.add("active")})),t.addEventListener("blur",(()=>{if(setTimeout((()=>{t.classList.remove("active")}),100),this.getForceUseOfResult()){const e=document.querySelectorAll(`${this.getEl()} .needletail-autocomplete-bar-result`);if(e.length<1)return void u.emit(u.onForceResultBlur,{query:this.getQuery(),value:null});-1===this.selectedResult&&(this.selectedResult=0,this.switchActiveClass(e),t.value=e[this.selectedResult].getAttribute("data-attribute"),this.handleUrlChange(t),u.emit(u.onForceResultBlur,{query:this.getQuery(),value:e[this.selectedResult].dataset}))}})),this.getInitialInput()&&t.addEventListener("input",(e=>{document.querySelectorAll(`${this.getEl()} .needletail-autocomplete-bar-result.needletail-initial-input`).forEach((e=>{e.setAttribute("data-attribute",t.value)})),t.setAttribute("data-initial-value",t.value)})),this.getUseDebounce()?(t.addEventListener("input",s((()=>{const e=document.querySelectorAll(`${this.getEl()} .needletail-autocomplete-bar-result`);this.selectedResult=-1,this.switchActiveClass(e),this.handle(t)}),this.getDebounceWait())),this.getInUrl()&&t.addEventListener("input",s((()=>{this.handleUrlChange(t)}),this.getDebounceUrlWait()))):t.addEventListener("input",(()=>{const e=document.querySelectorAll(`${this.getEl()} .needletail-autocomplete-bar-result`);this.selectedResult=-1,this.switchActiveClass(e),this.handleUrlChange(t),this.handle(t)})),t.addEventListener("keydown",(e=>{if(t.classList.add("active"),"ArrowUp"===e.key||"ArrowDown"===e.key){e.preventDefault();const s=document.querySelectorAll(`${this.getEl()} .needletail-autocomplete-bar-result`);if(s.length<1)return;"ArrowUp"===e.key?this.selectedResult>0&&this.selectedResult--:"ArrowDown"===e.key&&this.selectedResult<s.length-1&&this.selectedResult++,this.switchActiveClass(s),t.value=s[this.selectedResult].getAttribute("data-attribute"),this.getForceUseOfResult()&&(this.selectedResult<this.skipForceResults?t.setAttribute("data-force","on"):t.setAttribute("data-force","off")),this.handleUrlChange(t),u.emit(u.onArrowMovementSearch,{query:this.getQuery(),value:s[this.selectedResult].dataset})}else if("Enter"===e.key){const e=document.querySelectorAll(`${this.getEl()} .needletail-autocomplete-bar-result`);this.getForceUseOfResult()&&"on"===t.getAttribute("data-force")&&(t.value=e[this.skipForceResults].getAttribute("data-attribute"),this.selectedResult=this.skipForceResults),this.handleUrlChange(t),u.emit(u.onSubmitSearch,{query:this.getQuery(),value:e[this.selectedResult]?e[this.selectedResult].dataset:t.value})}else"Escape"===e.key&&(this.getInitialInput()&&(t.value=t.getAttribute("data-initial-value")),document.querySelectorAll(":focus").forEach((e=>e.blur())))}))})),document.addEventListener(u.onBeforeSearch,(e=>m(this,void 0,void 0,(function*(){e.detail.query===this.getQuery()?(e.detail.extra_search_values={},u.emit(u.onSearch,e.detail)):e.preventDefault()})))),document.addEventListener(u.onSearch,(e=>m(this,void 0,void 0,(function*(){if(e.detail.query!==this.getQuery())return void e.preventDefault();let t=this.getAttributes();"string"==typeof t&&(t=[t]);const s=[];t.forEach((t=>{s.push({field:t,value:e.detail.value})}));const i=yield this.client.search({buckets:this.getBuckets(),search:Object.assign({should:{fuzzy:s}},e.detail.extra_search_values),sort:this.getSortBy(),direction:this.getSortDirection(),size:this.getSize(),group_by:this.getGroupBy(),highlight:!0,show_bucket:this.getShowBucket(),mode:this.getSortMode()});e.detail.status=i.status,i&&i.data.count>0&&(e.detail.search_result=i.data.results.map((e=>{const t=e.bucket?e.bucket.toString():"",s=Object.assign(Object.assign({id:e.id},e.record),{bucket:""!==t&&this.getBucketMapping()[t]?this.getBucketMapping()[t]:"",value:{},raw:{}});e.highlight&&(s.highlight={});let i=this.getAttributes();return"string"==typeof i&&(i=[i]),i.forEach((t=>{s.value[t]=e.record[t],s.raw[t]=e.record[t],e.highlight&&(s.highlight[t]=e.highlight[t])})),s}))),u.emit(u.onAfterSearch,e.detail)})))),document.addEventListener(u.onAfterSearch,(e=>m(this,void 0,void 0,(function*(){if(e.detail.query!==this.getQuery())return void e.preventDefault();let t={results:[],initial_input:""};e.detail.search_result&&e.detail.search_result.length>0&&e.detail.value&&0!==e.detail.value.length&&(t={results:e.detail.search_result,initial_input:this.getInitialInput()?e.detail.value:""}),this.buildResults(t),u.emit(u.autocompleteBarFinished,{name:this.getDiscriminator()})}))))}buildResults(e={}){if(!this.getShowResults())return;const t=this.renderResults(e),s=document.createRange().createContextualFragment(t);document.querySelectorAll(`.needletail-autocomplete-bar-${this.getQuery()}`).forEach((e=>m(this,void 0,void 0,(function*(){const t=e.querySelector(".needletail-autocomplete-bar-results");yield e.replaceChild(s.cloneNode(!0),t);const i=e.querySelector(".needletail-autocomplete-bar-results").querySelectorAll(".needletail-autocomplete-bar-result");i.forEach((e=>{e.addEventListener("mouseover",(t=>{this.selectedResult=Array.prototype.indexOf.call(i,e),i.forEach((e=>{e.classList.remove("active")})),i[this.selectedResult].classList.add("active")})),e.addEventListener("click",(t=>{if(this.getFillInputOnClick()){document.querySelectorAll(`.needletail-autocomplete-bar-${this.getQuery()} .needletail-autocomplete-bar-input`).forEach((t=>{t.value=e.getAttribute("data-attribute"),this.handleUrlChange(t)}))}u.emit(u.onSubmitSearch,{query:this.getQuery(),value:e.dataset})}))}));const l=e.querySelector(".needletail-autocomplete-bar-input");l&&l.value.length>0&&l.classList.remove("needletail-empty")}))))}handleUrlChange(e){var t;this.getInUrl()&&r.addToHistory(this.getQuery(),null!==(t=e.getAttribute("data-initial-value"))&&void 0!==t?t:e.value)}handle(e){let t;const s=e.value;s&&s.length<this.getMinimumCharacters()?(t={value:"",search_result:{}},this.value={field:this.getAttribute(),value:""}):(t={value:s,search_result:{}},this.value={field:this.getAttribute(),value:s}),0==s.length&&e.classList.add("needletail-empty"),t.query=this.getQuery(),u.emit(u.onBeforeSearch,t),this.getLiveResults()&&u.emit(u.onBeforeResultRequest,{})}switchActiveClass(e){this.getShowResults()&&(e.forEach((e=>{e.classList.remove("active")})),this.selectedResult>-1&&e[this.selectedResult].classList.add("active"))}}class f extends n{constructor(e={}){super(e),this.discriminator="GroupedSearchBar",this.debounce=!0,this.debounceWait=200,this.debounceUrlWait=2e3,this.query="groupedSearchBar",this.inUrl=!0,this.buckets=[],this.placeholder="Start typing to search",this.noResultMessage="No results where found",this.selectedResult=-1,this.value={},this.size=3,this.minimumCharacters=3,this.groupBy="",this.sortBy="",this.sortDirection="asc",this.showResults=!0,this.searchOnContentLoaded=!0,this.initialInput=!0,this.fillInputOnClick=!1,this.sortMode="min",this.allowedDirections=["asc","desc"],this.setUseDebounce(void 0!==h(e.debounce).use?e.debounce.use:this.getUseDebounce()),this.setDebounceWait(h(e.debounce).wait||this.getDebounceWait()),this.setDebounceUrlWait(h(e.debounce).url_wait||this.getDebounceUrlWait()),this.setInUrl(void 0!==e.in_url?e.in_url:this.getInUrl()),this.setQuery(e.query||this.getQuery()),this.setAttribute(h(e.search).attribute||""),this.setAttributes(h(e.search).attributes||""),this.setBuckets(h(e.search).buckets||[]),this.setPlaceholder(e.placeholder||this.getPlaceholder()),this.setNoResultMessage(e.no_result_message||this.getNoResultMessage()),this.setSize(h(e.search).size||this.getSize()),this.setGroupBy(h(e.search).group_by||""),this.setSortBy(h(e.search).sort_by||""),this.setSortDirection(h(e.search).sort_direction||this.getSortDirection()),this.setSortMode(h(e.search).sort_mode||this.getSortMode()),this.setMinimumCharacters(void 0!==e.minimum_characters?e.minimum_characters:this.getMinimumCharacters()),this.setShowResults(void 0!==e.show_results?e.show_results:this.getShowResults()),this.setSearchOnContentLoaded(void 0!==e.search_on_content_loaded?e.search_on_content_loaded:this.getSearchOnContentLoaded()),this.setInitialInput(void 0!==e.initial_input?e.initial_input:this.getInitialInput()),this.setFillInputOnClick(void 0!==e.fill_input_on_click?e.fill_input_on_click:this.getFillInputOnClick())}setMinimumCharacters(e){return this.minimumCharacters=e,this}getMinimumCharacters(){return this.minimumCharacters}setSize(e){return this.size=e,this}getSize(){return this.size}setPlaceholder(e){return this.placeholder=e,this}getPlaceholder(){return this.placeholder}setNoResultMessage(e){return this.noResultMessage=e,this}getNoResultMessage(){return this.noResultMessage}setAttribute(e){return this.attribute=e,this}getAttribute(){return this.attribute}setAttributes(e){return""===this.attribute&&(this.attribute=e),this}getAttributes(){return this.attribute}setBuckets(e){return this.buckets=e,this}getBuckets(){return this.buckets}setUseDebounce(e=!0){return this.debounce=e,this}getUseDebounce(){return this.debounce}setDebounceWait(e){return this.debounceWait=e,this}getDebounceWait(){return this.debounceWait}setDebounceUrlWait(e){return this.debounceUrlWait=e,this}getDebounceUrlWait(){return this.debounceUrlWait}getTemplate(){return this.template?this.template:'<div class="needletail-grouped-search-bar needletail-grouped-search-bar-{{ name }}">\n    <input type="text" class="needletail-grouped-search-bar-input needletail-empty" autocomplete="off" spellcheck="false" placeholder="{{ placeholder }}">\n    {{{ results }}}\n</div>'}setResultTemplate(e){return this.resultTemplate=e,this}getResultTemplate(){return this.resultTemplate?this.resultTemplate:'<div class="needletail-grouped-search-bar-results">\n    <div class="needletail-grouped-search-bar-result-results">\n        {{#initial_input}}\n            <div class="needletail-grouped-search-bar-result needletail-initial-input" data-attribute="{{ initial_input }}">\n                {{{ initial_input }}}\n            </div>\n        {{/initial_input}}\n    </div>\n\n    {{#results}}\n        {{{ . }}}\n    {{/results}}\n    {{^results}}\n        <div class="needletail-grouped-search-bar-no-result">\n            {{{ no_result_message }}}\n        </div>\n    {{/results}}\n</div>'}setInnerResultTemplate(e){return this.innerResultTemplate=e,this}getInnerResultTemplate(){return this.innerResultTemplate?this.innerResultTemplate:'<div class="needletail-grouped-search-bar-result-title">\n    {{ key }}\n</div>\n<div class="needletail-grouped-search-bar-result-results">\n    {{#results}}\n        <div class="needletail-grouped-search-bar-result" data-attribute="{{ raw.title }}">\n            {{#highlight.title}}{{{ highlight.title }}}{{/highlight.title}}{{^highlight.title}}{{ title }}{{/highlight.title}}\n        </div>\n    {{/results}}\n</div>'}setInUrl(e){return this.inUrl=e,this}getInUrl(){return this.inUrl}setShowResults(e){return this.showResults=e,this}getShowResults(){return this.showResults}setDiscriminator(e){return this.discriminator=e,this}getDiscriminator(){return this.discriminator}setSearchOnContentLoaded(e){return this.searchOnContentLoaded=e,this}getSearchOnContentLoaded(){return this.searchOnContentLoaded}setInitialInput(e){return this.initialInput=e,this}getInitialInput(){return this.initialInput}setGroupBy(e){return this.groupBy=e,this}getGroupBy(){return this.groupBy}setSortBy(e){return this.sortBy=e,this}getSortBy(){return this.sortBy}setSortMode(e){return this.sortMode=e,this}getSortMode(){return this.sortMode}setSortDirection(e){return-1===this.allowedDirections.indexOf(e)&&(e="asc"),this.sortDirection=e,this}getSortDirection(){return this.sortDirection}setFillInputOnClick(e){return this.fillInputOnClick=e,this}getFillInputOnClick(){return this.fillInputOnClick}render(e={}){const s=this.getTemplate();e=Object.assign({name:this.getQuery(),placeholder:this.getPlaceholder(),results:this.renderResults()},e);const i=t.render(s,e);return document.createRange().createContextualFragment(i)}renderResults(e={}){const s=this.getResultTemplate();return e=Object.assign({no_result_message:this.getNoResultMessage()},e),t.render(s,e)}renderResultTemplates(e={},s=null){const i=s||this.getInnerResultTemplate();return t.render(i,e)}getQuery(){return this.query}setQuery(e){return this.query=e,this}executeJS(){const e=r.getSearchParam(this.getQuery());document.querySelectorAll(`${this.getEl()} .needletail-grouped-search-bar-input`).forEach((t=>{t.value=e||"",document.addEventListener("DOMContentLoaded",(()=>{this.getSearchOnContentLoaded()&&this.handle(t)})),t.addEventListener("focus",(()=>{t.classList.add("active")})),t.addEventListener("blur",(()=>{setTimeout((()=>{t.classList.remove("active")}),100)})),this.getInitialInput()&&t.addEventListener("input",(e=>{document.querySelectorAll(`${this.getEl()} .needletail-grouped-search-bar-result.needletail-initial-input`).forEach((e=>{e.innerHTML=t.value,e.setAttribute("data-attribute",t.value)})),t.setAttribute("data-initial-value",t.value)})),this.getUseDebounce()?(t.addEventListener("input",s((()=>{const e=document.querySelectorAll(`${this.getEl()} .needletail-grouped-search-bar-result`);this.selectedResult=-1,this.switchActiveClass(e),this.handle(t)}),this.getDebounceWait())),this.getInUrl()&&t.addEventListener("input",s((()=>{this.handleUrlChange(t)}),this.getDebounceUrlWait()))):t.addEventListener("input",(()=>{const e=document.querySelectorAll(`${this.getEl()} .needletail-grouped-search-bar-result`);this.selectedResult=-1,this.switchActiveClass(e),this.handleUrlChange(t),this.handle(t)})),t.addEventListener("keydown",(e=>{if(t.classList.add("active"),"ArrowUp"===e.key||"ArrowDown"===e.key){e.preventDefault();const s=document.querySelectorAll(`${this.getEl()} .needletail-grouped-search-bar-result`);if(s.length<1)return;"ArrowUp"===e.key?this.selectedResult>0&&this.selectedResult--:"ArrowDown"===e.key&&this.selectedResult<s.length-1&&this.selectedResult++,this.switchActiveClass(s),t.value=s[this.selectedResult].getAttribute("data-attribute"),u.emit(u.onArrowMovementGroupedSearch,{query:this.getQuery(),value:s[this.selectedResult].dataset})}else if("Enter"===e.key){const e=document.querySelectorAll(`${this.getEl()} .needletail-grouped-search-bar-result`);u.emit(u.onSubmitGroupedSearch,{query:this.getQuery(),value:e[this.selectedResult]?e[this.selectedResult].dataset:t.value})}else"Escape"===e.key&&(this.getInitialInput()&&(t.value=t.getAttribute("data-initial-value")),document.querySelectorAll(":focus").forEach((e=>e.blur())))}))})),document.addEventListener(u.onBeforeGroupedSearch,(e=>m(this,void 0,void 0,(function*(){e.detail.query===this.getQuery()?(e.detail.extra_search_values={},u.emit(u.onGroupedSearch,e.detail)):e.preventDefault()})))),document.addEventListener(u.onGroupedSearch,(e=>m(this,void 0,void 0,(function*(){if(e.detail.query!==this.getQuery())return void e.preventDefault();const t={};this.getBuckets().forEach((s=>{if("object"==typeof s){if(s.name){let i=s.attribute||this.getAttributes();"string"==typeof i&&(i=[i]);const l=[];i.forEach((t=>{l.push({field:t,value:e.detail.value})})),t[s.name]={search:Object.assign({should:{fuzzy:l}},e.detail.extra_search_values),sort:s.sort||this.getSortBy(),direction:s.direction||this.getSortDirection(),size:s.size||this.getSize(),group_by:s.group_by||this.getGroupBy(),highlight:!0,mode:s.sort_mode||this.getSortMode()}}}else{let i=this.getAttributes();"string"==typeof i&&(i=[i]);const l=[];i.forEach((t=>{l.push({field:t,value:e.detail.value})})),t[s]={search:Object.assign({should:{fuzzy:l}},e.detail.extra_search_values),sort:this.getSortBy(),direction:this.getSortDirection(),size:this.getSize(),group_by:this.getGroupBy(),highlight:!0,mode:this.getSortMode()}}}));const s=yield this.client.bulk({buckets:t});e.detail.status=s.status,s&&s.data&&(e.detail.search_result=[],Object.keys(s.data).forEach((t=>{var i;const l=s.data[t],a=this.getBuckets().find((e=>e.name===t||e===t));l.count>0&&e.detail.search_result.push({raw:a,key:null!==(i=a.key)&&void 0!==i?i:t,results:l.results.map((e=>{var t;const s=Object.assign(Object.assign({id:e.id},e.record),{value:{},raw:{}});e.highlight&&(s.highlight={});let i=null!==(t=a.attribute)&&void 0!==t?t:this.getAttributes();return"string"==typeof i&&(i=[i]),i.forEach((t=>{s.value[t]=e.record[t],s.raw[t]=e.record[t],e.highlight&&(s.highlight[t]=e.highlight[t])})),s}))})}))),u.emit(u.onAfterGroupedSearch,e.detail)})))),document.addEventListener(u.onAfterGroupedSearch,(e=>m(this,void 0,void 0,(function*(){if(e.detail.query!==this.getQuery())return void e.preventDefault();let t={};e.detail.search_result&&Object.keys(e.detail.search_result).length>0&&(t={results:e.detail.search_result,initial_input:e.detail.value}),this.buildResults(t),u.emit(u.groupedSearchBarFinished,{name:this.getDiscriminator()})}))))}buildResults(e={}){if(!this.getShowResults())return;const t=[];e&&e.results&&(e.results.forEach((e=>{const s=this.getBuckets().find((t=>t.key===e.key||t===e.key));s&&s.template?t.push(this.renderResultTemplates(e,s.template)):t.push(this.renderResultTemplates(e))})),e.results=t);const s=this.renderResults(e),i=document.createRange().createContextualFragment(s);document.querySelectorAll(`.needletail-grouped-search-bar-${this.getQuery()}`).forEach((e=>{const t=e.querySelector(".needletail-grouped-search-bar-results");e.replaceChild(i.cloneNode(!0),t);const s=e.querySelector(".needletail-grouped-search-bar-results").querySelectorAll(".needletail-grouped-search-bar-result");s.forEach((e=>{e.addEventListener("mouseover",(t=>{this.selectedResult=Array.prototype.indexOf.call(s,e),s.forEach((e=>{e.classList.remove("active")})),s[this.selectedResult].classList.add("active")})),e.addEventListener("click",(t=>{if(this.getFillInputOnClick()){document.querySelectorAll(`.needletail-grouped-search-bar-${this.getQuery()} .needletail-grouped-search-bar-input`).forEach((t=>{t.value=e.getAttribute("data-attribute"),this.handleUrlChange(t)}))}u.emit(u.onSubmitGroupedSearch,{query:this.getQuery(),value:e.dataset})}))}));const l=e.querySelector(".needletail-grouped-search-bar-input");l&&l.value.length>0&&l.classList.remove("needletail-empty")}))}handleUrlChange(e){this.getInUrl()&&r.addToHistory(this.getQuery(),e.getAttribute("data-initial-value"))}handle(e){let t;const s=e.value;s&&s.length<this.getMinimumCharacters()?(t={value:"",search_result:{}},this.value={field:this.getAttributes(),value:""}):(t={value:s,search_result:{}},this.value={field:this.getAttributes(),value:s}),0==s.length&&e.classList.add("needletail-empty"),t.query=this.getQuery(),u.emit(u.onBeforeGroupedSearch,t)}switchActiveClass(e){this.getShowResults()&&(e.forEach((e=>{e.classList.remove("active")})),this.selectedResult>-1&&e[this.selectedResult].classList.add("active"))}}class S extends n{constructor(e={}){super(e),this.discriminator="Result",this.perPage=10,this.previous="Previous",this.next="Next",this.last="Last",this.first="First",this.showQuickPagination=!1,this.minifyPages=5,this.groupBy="",this.sortBy="",this.sortSelect={},this.sortDirection="",this.noResultMessage="No results where found",this.initialRequest=!0,this.scrollOffset=100,this.scrollBackToTop=!0,this.buckets=[],this.sortMode="min",this.allowedDirections=["asc","desc"],this.activeClass="active",this.hideOnSinglePage=!0,this.hidePagination=!1,this.query="result",this.infiniteScroll=!1,this.infinityPage=1,this.hardReset=!1,this.totalPages=1,this.bottomScrollOffset=0,this.loader=null,this.allowedLoaders=["round-dots","round-line","straight-bars","straight-dots"],this.totalResults=0,this.totalResultsText=":count total results",this.extraOptions={},this.useSkeleton=!1,this.setQuery(e.query||this.getQuery()),this.setPerPage(e.per_page||this.getPerPage()),this.setPrevious(h(e.pagination).previous||this.getPrevious()),this.setNext(h(e.pagination).next||this.getNext()),this.setMinifyPages(e.minify_pages||this.getMinifyPages()),this.setLast(h(e.pagination).last||this.getLast()),this.setFirst(h(e.pagination).first||this.getFirst()),this.setShowQuickPagination(void 0!==h(e.pagination).show_quick_pagination?e.pagination.show_quick_pagination:this.getShowQuickPagination()),this.setScrollOffset(h(e.pagination).scroll_offset||this.getScrollOffset()),this.setScrollBackToTop(void 0!==h(e.pagination).scroll_back_to_top?e.pagination.scroll_back_to_top:this.getScrollBackToTop()),this.setHideOnSinglePage(void 0!==h(e.pagination).hide_on_single_page?e.pagination.hide_on_single_page:this.getHideOnSinglePage()),this.setResultTemplate(e.result_template),this.setGroupBy(e.group_by||""),this.setSortSelect(e.sort_select||{}),this.setSortSelectDefault(e.sort_select_default||""),this.setSortBy(e.sort_by||""),this.setSortDirection(e.sort_direction||this.getSortDirection()),this.setSortMode(e.sort_mode||this.getSortMode()),this.setNoResultMessage(e.no_result_message||this.getNoResultMessage()),this.setBuckets(e.buckets||[]),this.setPaginationActiveClass(h(e.pagination).active_class||this.getPaginationActiveClass()),this.setInfiniteScroll(h(e.pagination).infinite_scroll||this.getInfiniteScroll()),this.setBottomScrollOffset(h(e.pagination).bottom_scroll_offset||this.getBottomScrollOffset()),this.setLoader(e.loader||this.getLoader()),this.setTotalResultsText(e.total_results_text||this.getTotalResultsText()),this.setExtraOptions(e.extra_options||{}),this.setUseSkeleton(void 0!==h(e).use_skeleton?h(e).use_skeleton:this.getUseSkeleton()),this.setSkeletonTemplate(h(e).skeleton_template||this.getSkeletonTemplate())}getUseSkeleton(){return this.useSkeleton}setUseSkeleton(e){return this.useSkeleton=e,this}getSkeletonTemplate(){return this.skeletonTemplate?this.skeletonTemplate:'<div class="needletail-skeleton needletail-result">\n    <ul class="needletail-skeleton-spacing needletail-skeleton-spacing--l">\n        {{#records}}\n            <li class="needletail-skeleton-base">\n                <div class="needletail-skeleton-media">\n                    <span class="needletail-skeleton-box" style="width:100px;height:100px;"></span>\n                </div>\n                <div class="needletail-skeleton-body">\n                    <div class="needletail-skeleton-spacing">\n                        <h3 class="needletail-skeleton-header">\n                            <span class="needletail-skeleton-box" style="width:55%;"></span>\n                        </h3>\n                        <p>\n                            <span class="needletail-skeleton-box" style="width:80%;"></span>\n                            <span class="needletail-skeleton-box" style="width:90%;"></span>\n                            <span class="needletail-skeleton-box" style="width:83%;"></span>\n                            <span class="needletail-skeleton-box" style="width:80%;"></span>\n                        </p>\n                    </div>\n                </div>\n            </li>\n        {{/records}}\n    </ul>\n</div>\n'}setSkeletonTemplate(e){return this.skeletonTemplate=e,this}getQuery(){return this.query}setQuery(e){return this.query=e,this}getTotalResults(){return this.totalResults}setTotalResults(e){return this.totalResults=e,this}getTotalResultsText(){var e;const t=null!==(e=this.getTotalResults())&&void 0!==e?e:0;let s=this.totalResultsText;s=s.replace(/:count/gi,t.toString());const i=s.split("|");if(0===i.length)return s;const l=/^{(\d+)} (.+)/,a=/^\[(\d+),(\d+|\*)] (.+)/;let n=s;return i.forEach((e=>{const s=l.exec(e);s&&t===parseInt(s[1])&&(n=s[2]);const i=a.exec(e);if(i){let e=!1;"*"===i[2]&&(e=!0),t>=parseInt(i[1])&&(t<=parseInt(i[2])||e)&&(n=i[3])}})),n}setTotalResultsText(e){return this.totalResultsText=e,this}getInfiniteScroll(){return this.infiniteScroll}setInfiniteScroll(e){return this.infiniteScroll=e,this}getBottomScrollOffset(){return this.bottomScrollOffset}setBottomScrollOffset(e){return this.bottomScrollOffset=e,this}getLoader(){return this.loader}setLoader(e){return-1!==this.allowedLoaders.indexOf(e)&&(this.loader=e),this}setHideOnSinglePage(e){return this.hideOnSinglePage=e,this}getHideOnSinglePage(){return this.hideOnSinglePage}setPaginationActiveClass(e){return this.activeClass=e,this}getPaginationActiveClass(){return this.activeClass}setBuckets(e){return this.buckets=e,this}getBuckets(){return this.buckets}setScrollBackToTop(e){return this.scrollBackToTop=e,this}getScrollBackToTop(){return this.scrollBackToTop}setScrollOffset(e){return this.scrollOffset=e,this}getScrollOffset(){return this.scrollOffset}setPerPage(e){return this.perPage=e,this}getPerPage(){return this.perPage}setShowQuickPagination(e){return this.showQuickPagination=e,this}getShowQuickPagination(){return this.showQuickPagination}setMinifyPages(e){return this.minifyPages=e,this}getMinifyPages(){return this.minifyPages}setPrevious(e){return this.previous=e,this}getPrevious(){return this.previous}setNext(e){return this.next=e,this}getNext(){return this.next}getTemplate(){return this.template?this.template:'<div class="needletail-result">\n    <div class="needletail-total-results">\n        {{ total_results_text }}\n    </div>\n    {{#use_sort_select}}\n        {{{ sort_select }}}\n    {{/use_sort_select}}\n    <div class="needletail-result-results {{ hide_on_initial_request }}">\n        {{{results}}}\n    </div>\n    {{#infinite_scroll}}\n    <div class="needletail-loader infinity-scroll"></div>\n    {{/infinite_scroll}}\n\n    <div class="needletail-result-pagination {{ hide_pagination }}">\n        {{#first_button}}\n            <div class="needletail-result-pagination-page needletail-result-pagination-first {{ disable_first_button }}" data-page="{{ first_page }}">{{{ first_button }}}</div>\n        {{/first_button}}\n        <div class="needletail-result-pagination-page needletail-result-pagination-previous {{ disable_previous_button }}" data-page="{{ previous_page }}">{{{ previous_button }}}</div>\n        {{#pages}}\n            <div class="needletail-result-pagination-page {{active}}" data-offset="{{offset}}" data-page="{{page}}">\n                {{page}}\n            </div>\n        {{/pages}}\n        <div class="needletail-result-pagination-page needletail-result-pagination-next {{ disable_next_button }}" data-page="{{ next_page }}">{{{ next_button }}}</div>\n        {{#last_button}}\n            <div class="needletail-result-pagination-page needletail-result-pagination-last {{ disable_last_button }}" data-page="{{ last_page }}">{{{ last_button }}}</div>\n        {{/last_button}}\n    </div>\n</div>\n'}getResultTemplate(){return this.resultTemplate?this.resultTemplate:'{{#results}}\n    <div class="needletail-result-result">\n        <div class="needletail-result-title">{{ title }}</div>\n        <div class="needletail-result-body">{{ body }}</div>\n    </div>\n{{/results}}\n{{^results}}\n    <div class="needletail-result-no-result">\n        {{{ no_result_message }}}\n    </div>\n{{/results}}'}setResultTemplate(e){return this.resultTemplate=e,this}setResultSortSelectTemplate(e){return this.sortSelectTemplate=e,this}getResultSortSelectTemplate(){return this.sortSelectTemplate?this.sortSelectTemplate:'<select class="needletail-sort-select">\n    {{#options}}\n        <option value="{{ name }}" data-attribute="{{ attribute }}" data-direction="{{ direction }}">{{#display_name}}{{{ display_name }}}{{/display_name}}{{^display_name}}{{ name }}{{/display_name}}</option>\n    {{/options}}\n</select>'}setFirst(e){return this.first=e,this.setShowQuickPagination(!0),this}getFirst(){return this.first}setLast(e){return this.last=e,this.setShowQuickPagination(!0),this}getLast(){return this.last}setGroupBy(e){return this.groupBy=e,this}getGroupBy(){return this.groupBy}setSortBy(e){if(""===e&&Object.keys(this.getSortSelect()).length>0)for(const t in this.getSortSelect())this.getSortSelect()[t].name===this.getSortSelectDefault()&&(e=this.getSortSelect()[t].attribute||"");return this.sortBy=e,this}getSortBy(){return this.sortBy}setSortMode(e){return this.sortMode=e,this}getSortMode(){return this.sortMode}setSortDirection(e){if(""===e&&Object.keys(this.getSortSelect()).length>0)for(const t in this.getSortSelect())this.getSortSelect()[t].name===this.getSortSelectDefault()&&(e=this.getSortSelect()[t].direction||"");return-1===this.allowedDirections.indexOf(e)&&(e="asc"),this.sortDirection=e,this}getSortDirection(){return this.sortDirection}setSortSelect(e){return this.sortSelect=e,this}getSortSelect(){return this.sortSelect}setSortSelectDefault(e){return this.sortSelectDefault=e,this}getSortSelectDefault(){return this.sortSelectDefault}setNoResultMessage(e){return this.noResultMessage=e,this}getNoResultMessage(){return this.noResultMessage}setExtraOptions(e){return this.extraOptions=e,this}getExtraOptions(){return this.extraOptions}renderSkeleton(){const e={records:new Array(this.getPerPage()).fill(null)},s=t.render(this.getSkeletonTemplate(),e);return document.createRange().createContextualFragment(s)}render(e=[],s=[],i=!0){const l=this.getTemplate(),a=[];e&&Object.keys(e).forEach((t=>{a.push(Object.assign({id:e[t].id},e[t].record))}));const n=parseInt(r.getSearchParam("page"))||1,o=s[s.length-1],u={previous_button:this.getPrevious(),next_button:this.getNext(),previous_page:n-1,next_page:n+1,disable_previous_button:0===s.length||1===n?"disabled":"",disable_next_button:0===s.length||o.page===n?"disabled":"",pages:s,results:this.renderResults({results:a,no_result_message:this.getNoResultMessage()}),last_button:"",first_button:"",first_page:0,last_page:0,disable_last_button:0===s.length||o.page===n?"disabled":"",disable_first_button:0===s.length||1===n?"disabled":"",use_sort_select:Object.keys(this.getSortSelect()).length>0,sort_select:this.renderSortSelect({options:this.getSortSelect()}),hide_pagination:this.hidePagination||this.getInfiniteScroll()?"needletail-hidden":"",hide_on_initial_request:i?"needletail-hide-on-initial-request":"",infinite_scroll:this.getInfiniteScroll(),total_results:this.getTotalResults(),total_results_text:this.getTotalResultsText(),extra_options:this.getExtraOptions()};this.getShowQuickPagination()&&(u.last_button=this.getLast(),u.first_button=this.getFirst(),u.first_page=1,u.last_page=h(o).page);const d=t.render(l,u);return document.createRange().createContextualFragment(d)}renderResults(e={}){const s=this.getResultTemplate();return e=Object.assign({},e),t.render(s,e)}renderSortSelect(e={}){const s=this.getResultSortSelectTemplate();return e=Object.assign({},e),t.render(s,e)}executeJS(){document.addEventListener(u.onBeforeResultRequest,s((e=>{if(e.detail.query||(e.detail.query=this.getQuery()),this.getUseSkeleton()){const e=this.renderSkeleton();document.querySelectorAll(this.getEl()).forEach((t=>{const s=t.querySelector(".needletail-result");t.replaceChild(e.cloneNode(!0),s)}))}const t=this.client.widgets.autocompleteBar,s=this.client.widgets.aggregationBar;let i=t.reduce(((e,t)=>t.getUseInResults()?(t.getBuckets().forEach((t=>{e.push(t)})),e):e),[]);i=i.concat(this.getBuckets());const l=t.reduce(((e,t)=>t.getUseInResults()?(Object.keys(t.value).length>0&&("string"==typeof t.value.field?e.push(t.value):t.value.field.forEach((s=>{e.push({field:s,value:t.value.value})}))),e):e),[]),a=s.map((e=>e.getValues()));e.detail.buckets=i,e.detail.search_values={},e.detail.equals_search_values={match:[...[].concat.apply([],a)]},e.detail.extra_search_values={},e.detail.should_search_values={fuzzy:[...[].concat.apply([],l)]},u.emit(u.onResultRequest,e.detail)}),100)),document.addEventListener(u.onResultRequest,s((e=>m(this,void 0,void 0,(function*(){let t,s=1,i=this.getPerPage();this.initialRequest&&(this.infinityPage=parseInt(r.getSearchParam("page"))||1),this.getInfiniteScroll()?(s=this.infinityPage,t=(s-1)*this.getPerPage(),this.initialRequest&&(i*=s,t=0)):(s=parseInt(r.getSearchParam("page"))||1,t=(s-1)*this.getPerPage());const l=yield this.client.search({buckets:e.detail.buckets,search:Object.assign({should:Object.assign({},e.detail.should_search_values),equals:Object.assign(Object.assign({},e.detail.search_values),e.detail.equals_search_values)},e.detail.extra_search_values),size:i,mode:this.getSortMode(),group_by:this.getGroupBy(),sort:this.getSortBy(),direction:this.getSortDirection(),offset:t});if(e.detail.status=l.status,l&&l.data){if(e.detail.count=l.data.count,this.setTotalResults(e.detail.count),l.data.results){e.detail.pages=[];for(let t=0;t<Math.ceil(l.data.count/this.getPerPage());t++)e.detail.pages.push({page:t+1,offset:t*this.getPerPage(),active:0===t&&!s||s===t+1?this.getPaginationActiveClass():""});const t=e.detail.pages.length;if(this.totalPages=t,1===t&&this.getHideOnSinglePage()?this.hidePagination=!0:this.hidePagination=!1,t>this.getMinifyPages()){let i=0;const l=[],a=[];let n=Math.ceil(this.getMinifyPages()/2),r=!1;if(t-n>=s){const i=e.detail.pages.pop();t-n!=s&&a.push({page:"...",offset:0,active:"disabled"}),a.push(i)}else r=!0;if(n<s){const a=e.detail.pages.shift();if(l.push(a),this.getMinifyPages()%2==1&&n++,r){let e=this.getMinifyPages();s==t?s--:s==t-2&&(e=n),i=s-e}else i=s-n;i>0&&l.push({page:"...",offset:0,active:"disabled"})}const o=e.detail.pages.splice(i,this.getMinifyPages());e.detail.pages=[...o],l.length>0&&e.detail.pages.unshift(...l),a.length>0&&e.detail.pages.push(...a)}e.detail.search_result=l.data.results}l.data.aggs&&u.emit(u.onAggsUpdate,l.data.aggs)}u.emit(u.onAfterResultRequest,e.detail)}))),100)),document.addEventListener(u.onPageChange,(e=>{if(!this.initialRequest&&this.getScrollBackToTop()){const e=document.querySelectorAll(this.getEl());if(1===e.length){const t=e.item(0).offsetTop-this.getScrollOffset();window.scrollTo({top:t,behavior:"smooth"})}}})),document.addEventListener(u.onAfterResultRequest,(e=>{const t=this.render(e.detail.search_result,e.detail.pages,!1);document.querySelectorAll(this.getEl()).forEach((e=>{const s=e.querySelector(".needletail-result");if(this.getInfiniteScroll()){const i=s.querySelectorAll(".needletail-result-result"),l=i[i.length-1];if(l&&!this.hardReset){let e;t.childNodes.forEach((t=>{t.classList&&t.classList.contains("needletail-result")&&!e&&(e=t.querySelector(".needletail-result-results"))})),l.after(...e.childNodes)}else e.replaceChild(t.cloneNode(!0),s),this.hardReset=!1}else e.replaceChild(t.cloneNode(!0),s),e.querySelectorAll(".needletail-result-pagination-page:not(.disabled):not(.active)").forEach((e=>{e.addEventListener("click",(t=>{const s=r.getSearchParam("page"),i=e.getAttribute("data-page");r.addToHistory("page",i),u.emit(u.onPageChange,{current_page:s,new_page:i}),u.emit(u.onBeforeResultRequest,{query:this.getQuery()})}))}))}));const s=document.getElementsByClassName("needletail-sort-select");for(let e=0;e<s.length;e++)s[e].value=this.getSortSelectDefault(),s[e].addEventListener("change",(e=>{this.setSortSelectDefault(e.target.value),this.setSortBy(e.target.options[e.target.selectedIndex].getAttribute("data-attribute")),this.setSortDirection(e.target.options[e.target.selectedIndex].getAttribute("data-direction")||"asc"),r.addToHistory("page","1"),this.infinityPage=1,this.hardReset=!0,u.emit(u.onBeforeResultRequest,{query:this.getQuery()})}));const i=document.querySelectorAll(".needletail-result-result");if(i.forEach(((e,t)=>{e.addEventListener("click",(e=>{r.addToHistory("index",t.toString())}))})),this.initialRequest){const e=i.item(parseInt(r.getSearchParam("index"))).offsetTop-this.getScrollOffset();window.scrollTo({top:e,behavior:this.getInfiniteScroll()?"smooth":"auto"})}this.stopLoader("infinity-scroll"),this.initialRequest=!1,u.emit(u.resultFinished,{name:this.discriminator})})),this.getInfiniteScroll()&&window.addEventListener("scroll",s((()=>{const{scrollTop:e,scrollHeight:t,clientHeight:s}=document.documentElement;e+s>=t-this.getBottomScrollOffset()&&this.totalPages>=this.infinityPage+1&&(this.infinityPage++,r.addToHistory("page",this.infinityPage.toString()),this.startLoader("infinity-scroll"),u.emit(u.onBeforeResultRequest,{query:this.getQuery()}))}),200)),document.addEventListener(u.onAggregationValueChange,(e=>{this.initialRequest||(r.addToHistory("page","1"),this.infinityPage=1,this.hardReset=!0)})),u.emit(u.onBeforeResultRequest,{query:this.getQuery()})}startLoader(e){if(this.getLoader()){document.querySelectorAll(`.needletail-loader.${e}`).forEach((e=>{e.classList.add(`needletail-loader-${this.getLoader()}`)}))}}stopLoader(e){document.querySelectorAll(`.needletail-loader.${e}`).forEach((e=>{e.classList.remove(`needletail-loader-${this.getLoader()}`)}))}}class b extends n{constructor(e={}){super(e),this.discriminator="AggregationBar",this.useClearFilters=!1,this.clearFiltersTop=!1,this.clearFiltersBottom=!1,this.clearFiltersText="Clear filters",this.clearFiltersHideOnNoneActive=!0,this.aggregationActives={},this.fields=[],this.setUseClearFilters(h(e.clear_filters).use||this.getUseClearFilters()),this.setClearFiltersTop(h(e.clear_filters).top||this.getClearFiltersTop()),this.setClearFiltersBottom(h(e.clear_filters).bottom||this.getClearFiltersBottom()),this.setClearFiltersText(h(e.clear_filters).text||this.getClearFiltersText()),this.setClearFiltersHideOnNoneActive(h(e.clear_filters).hide_on_none_active||this.getClearFiltersHideOnNoneActive())}setUseClearFilters(e){return this.useClearFilters=e,this}getUseClearFilters(){return this.useClearFilters}setClearFiltersTop(e){return this.clearFiltersTop=e,this}getClearFiltersTop(){return this.clearFiltersTop}setClearFiltersBottom(e){return this.clearFiltersBottom=e,this}getClearFiltersBottom(){return this.clearFiltersBottom}setClearFiltersText(e){return this.clearFiltersText=e,this}getClearFiltersText(){return this.clearFiltersText}setClearFiltersHideOnNoneActive(e){return this.clearFiltersHideOnNoneActive=e,this}getClearFiltersHideOnNoneActive(){return this.clearFiltersHideOnNoneActive}addField(e){return this.fields.push(e),this}addMultipleFields(e){return e.forEach((e=>{this.fields.push(e)})),this}getTemplate(){return this.template?this.template:'<div class="needletail-aggregation-bar">\n    {{#show_clear_filters_top}}\n        <div class="needletail-clear-filters-top">\n            {{{ clear_filters }}}\n        </div>\n    {{/show_clear_filters_top}}\n    {{#fields}}\n        <div class="needletail-aggregation-item">\n            {{{ . }}}\n        </div>\n    {{/fields}}\n    {{#show_clear_filters_bottom}}\n        <div class="needletail-clear-filters-bottom">\n            {{{ clear_filters }}}\n        </div>\n    {{/show_clear_filters_bottom}}\n</div>'}setDiscriminator(e){return this.discriminator=e,this}getDiscriminator(){return this.discriminator}render(){const e=this.getTemplate(),s=[];this.fields.forEach((e=>{const t=e.render();s.push(t)}));const i=t.render(e,{fields:s,clear_filters:this.renderClearFilters(),show_clear_filters_top:this.getClearFiltersTop(),show_clear_filters_bottom:this.getClearFiltersBottom()});return document.createRange().createContextualFragment(i)}setClearFiltersTemplate(e){return this.clearFiltersTemplate=e,this}getClearFiltersTemplate(){return this.clearFiltersTemplate?this.clearFiltersTemplate:'<span class="needletail-clear-filters {{ hidden }}">{{{ text }}}</span>'}renderClearFilters(){const e=this.getClearFiltersTemplate();return t.render(e,{text:this.getClearFiltersText(),hidden:this.getClearFiltersHideOnNoneActive()?"needletail-hidden":""})}executeJS(){const e=document.getElementsByClassName("needletail-clear-filters");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(()=>{this.fields.forEach((e=>{e.reset()}))}));document.addEventListener("DOMContentLoaded",(()=>{this.fields.forEach((e=>{setTimeout((()=>{e.setDefaultCollapsed(!1)}),1e3)})),u.emit(u.onAggregationValueChange,{})})),document.addEventListener(u.onAggregationValueChange,(e=>{this.aggregationActives[e.detail.name]=e.detail.hasActive;const t=document.getElementsByClassName("needletail-clear-filters");let s=!1;if(this.fields.forEach((e=>{let i=e.getTitle();if("Range"===e.discriminator&&(i=e.getTitle()+"[min]"),!s&&r.getSearchParam(i)){for(let e=0;e<t.length;e++)t[e].classList.remove("needletail-hidden");s=!0}})),!s)for(let e=0;e<t.length;e++)t[e].classList.add("needletail-hidden")})),this.fields.forEach((e=>{e.executeJS()})),u.emit(u.aggregationFinished,{name:this.getDiscriminator()})}getValues(){return this.fields.reduce(((e,t)=>(Object.keys(t.value).length>0&&e.push(t.value),e)),[])}}export{b as AggregationBar,v as AutocompleteBar,c as Checkbox,l as Client,u as Events,f as GroupedSearchBar,g as Radio,S as Result,p as Slider,d as Switch};
